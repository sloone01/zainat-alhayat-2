<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Media Integration - Complete Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .fix-card { background: white; border-radius: 8px; padding: 20px; margin: 16px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .fix-header { background: #dcfce7; padding: 12px; border-radius: 6px; margin-bottom: 16px; }
        .issue-box { background: #fee2e2; border: 1px solid #fca5a5; border-radius: 6px; padding: 12px; margin: 12px 0; }
        .solution-box { background: #dcfce7; border: 1px solid #86efac; border-radius: 6px; padding: 12px; margin: 12px 0; }
        .code-block { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 12px; margin: 12px 0; font-family: monospace; font-size: 14px; }
        .db-schema { background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; padding: 16px; margin: 12px 0; }
        .api-endpoint { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 12px; margin: 8px 0; }
        .highlight { background: #fbbf24; padding: 2px 4px; border-radius: 3px; }
        .step { margin: 12px 0; padding: 12px; border-radius: 6px; background: #f8fafc; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Ø¥ØµÙ„Ø§Ø­ Ø´Ø§Ù…Ù„ - ØªÙƒØ§Ù…Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</h1>
        
        <div class="fix-card">
            <div class="fix-header">
                <h2>ğŸš¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2>
                <p>Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙØ±ÙØ¹ Ù„Ù„Ø®Ø§Ø¯Ù… ÙˆÙ„ÙƒÙ† Ù„Ø§ ØªÙØ­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            </div>
            
            <div class="issue-box">
                <h3>âŒ Ù…Ø§ ÙƒØ§Ù† Ù…ÙÙ‚ÙˆØ¯Ø§Ù‹:</h3>
                <ul>
                    <li>Ø¬Ø¯ÙˆÙ„ session_media ØºÙŠØ± Ù…Ø·Ø¨Ù‚ ÙÙŠ TypeScript</li>
                    <li>Ù„Ø§ ØªÙˆØ¬Ø¯ Entity Ù„Ù„Ù€ SessionMedia</li>
                    <li>Ù„Ø§ ØªÙˆØ¬Ø¯ Service Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                    <li>Ù„Ø§ ØªÙˆØ¬Ø¯ Controller Ù„Ù„Ù€ API endpoints</li>
                    <li>Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØºÙŠØ± Ù…Ø·Ø¨Ù‚Ø©</li>
                    <li>Frontend ÙŠØ³ØªØ®Ø¯Ù… endpoints ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</li>
                </ul>
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ—„ï¸ Ù‡ÙŠÙƒÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚</h2>
            
            <div class="db-schema">
                <h3>Ø¬Ø¯ÙˆÙ„ session_media:</h3>
                <div class="code-block">
CREATE TABLE session_media (<br>
    <span class="highlight">id SERIAL PRIMARY KEY</span>,<br>
    session_plan_id VARCHAR(36) NOT NULL,<br>
    file_name VARCHAR(255) NOT NULL,<br>
    file_path VARCHAR(500) NOT NULL,<br>
    file_type VARCHAR(10) NOT NULL CHECK (file_type IN ('photo', 'video')),<br>
    file_size INTEGER NOT NULL,<br>
    mime_type VARCHAR(100) NOT NULL,<br>
    uploaded_by VARCHAR(36) NOT NULL,<br>
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,<br>
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,<br>
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,<br>
    <br>
    <span class="highlight">FOREIGN KEY (session_plan_id) REFERENCES weekly_session_plans(id)</span>,<br>
    <span class="highlight">FOREIGN KEY (uploaded_by) REFERENCES users(id)</span><br>
);
                </div>
            </div>
            
            <div class="db-schema">
                <h3>Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:</h3>
                <ul>
                    <li><strong>WeeklySessionPlan â†’ SessionMedia:</strong> One-to-Many</li>
                    <li><strong>User â†’ SessionMedia:</strong> One-to-Many (uploaded_by)</li>
                    <li><strong>SessionMedia â†’ WeeklySessionPlan:</strong> Many-to-One</li>
                    <li><strong>SessionMedia â†’ User:</strong> Many-to-One</li>
                </ul>
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ”§ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</h2>
            
            <div class="step">
                <h3>1. SessionMedia Entity</h3>
                <div class="code-block">
@Entity('session_media')<br>
export class SessionMedia {<br>
  @PrimaryGeneratedColumn()<br>
  id: number;<br><br>
  
  @Column({ name: 'session_plan_id' })<br>
  session_plan_id: string;<br><br>
  
  @Column({ length: 255 })<br>
  file_name: string;<br><br>
  
  // Relations<br>
  @ManyToOne(() => WeeklySessionPlan, plan => plan.media)<br>
  @JoinColumn({ name: 'session_plan_id' })<br>
  sessionPlan: WeeklySessionPlan;<br>
}
                </div>
            </div>
            
            <div class="step">
                <h3>2. SessionMedia Service</h3>
                <div class="code-block">
@Injectable()<br>
export class SessionMediaService {<br>
  async create(createDto: CreateSessionMediaDto): Promise&lt;SessionMedia&gt;<br>
  async createMultiple(mediaList: CreateSessionMediaDto[]): Promise&lt;SessionMedia[]&gt;<br>
  async findBySessionPlanId(sessionPlanId: string): Promise&lt;SessionMedia[]&gt;<br>
  async findById(id: number): Promise&lt;SessionMedia&gt;<br>
  async delete(id: number): Promise&lt;void&gt;<br>
}
                </div>
            </div>
            
            <div class="step">
                <h3>3. SessionMedia Controller</h3>
                <div class="api-endpoint">
                    <strong>POST /api/session-media/upload</strong><br>
                    Ø±ÙØ¹ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ù…Ø¹ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </div>
                <div class="api-endpoint">
                    <strong>POST /api/session-media/upload-multiple</strong><br>
                    Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ø¹ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </div>
                <div class="api-endpoint">
                    <strong>GET /api/session-media/session/:sessionPlanId</strong><br>
                    Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Ø¬Ù„Ø³Ø© Ù…Ø¹ÙŠÙ†Ø©
                </div>
                <div class="api-endpoint">
                    <strong>DELETE /api/session-media/:id</strong><br>
                    Ø­Ø°Ù Ù…Ù„Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø®Ø§Ø¯Ù…
                </div>
            </div>
            
            <div class="step">
                <h3>4. ØªØ­Ø¯ÙŠØ« WeeklySessionPlan</h3>
                <div class="code-block">
// Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© Media<br>
@OneToMany(() => SessionMedia, media => media.sessionPlan)<br>
media: SessionMedia[];<br><br>

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù„ØªØ´Ù…Ù„ Media<br>
.leftJoinAndSelect('wsp.media', 'media')
                </div>
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ“Š ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯</h2>
            
            <div class="step">
                <strong>1. Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù:</strong><br>
                Frontend â†’ POST /api/session-media/upload-multiple â†’ Controller
            </div>
            
            <div class="step">
                <strong>2. Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù:</strong><br>
                Controller â†’ Multer â†’ ./uploads/session-media/session_timestamp_random.ext
            </div>
            
            <div class="step">
                <strong>3. Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:</strong><br>
                Controller â†’ SessionMediaService â†’ Database (session_media table)
            </div>
            
            <div class="step">
                <strong>4. Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong><br>
                Database â†’ Service â†’ Controller â†’ Frontend (SessionMedia objects)
            </div>
            
            <div class="step">
                <strong>5. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong><br>
                Frontend â†’ GET /api/weekly-session-plans â†’ includes media relation â†’ UI
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ”„ ØªØ­Ø¯ÙŠØ« Frontend Service</h2>
            
            <div class="code-block">
// Ù‚Ø¨Ù„ (âŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… endpoint Ù…Ø¤Ù‚Øª)<br>
const uploadResult = await this.upload('/files/documents', formData)<br><br>

// Ø¨Ø¹Ø¯ (âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… endpoint Ù…Ø®ØµØµ)<br>
const response = await this.upload&lt;{<br>
  success: boolean<br>
  data: SessionMedia[]<br>
  message: string<br>
}&gt;(`${this.basePath}/upload-multiple`, formData)<br><br>

if (!response.success) {<br>
  throw new Error(response.message)<br>
}<br><br>

return response.data // SessionMedia objects from database
            </div>
        </div>

        <div class="fix-card">
            <h2>âœ… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
            
            <div class="solution-box">
                <h3>ğŸ¯ Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡:</h3>
                <ul>
                    <li>âœ… <strong>Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> session_media Ù…Ø·Ø¨Ù‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</li>
                    <li>âœ… <strong>Entity & Relations:</strong> SessionMedia Ù…Ø¹ Ø¹Ù„Ø§Ù‚Ø§Øª ØµØ­ÙŠØ­Ø©</li>
                    <li>âœ… <strong>Service Layer:</strong> CRUD operations ÙƒØ§Ù…Ù„Ø©</li>
                    <li>âœ… <strong>API Endpoints:</strong> Ø±ÙØ¹ ÙˆØ¬Ù„Ø¨ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª</li>
                    <li>âœ… <strong>File Storage:</strong> Ø­ÙØ¸ ÙÙŠ ./uploads/session-media</li>
                    <li>âœ… <strong>Database Integration:</strong> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø©</li>
                    <li>âœ… <strong>Frontend Integration:</strong> Ø§Ø³ØªØ®Ø¯Ø§Ù… endpoints Ø§Ù„ØµØ­ÙŠØ­Ø©</li>
                </ul>
            </div>
            
            <h3>ğŸ§ª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <ol>
                <li>Ø£ÙƒÙ…Ù„ Ù…Ù‡Ù…Ø© Ù…Ø¹ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙ‚Ø©</li>
                <li>ØªØ­Ù‚Ù‚ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ ./uploads/session-media</li>
                <li>ØªØ­Ù‚Ù‚ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„ session_media</li>
                <li>Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© - ÙŠØ¬Ø¨ Ø£Ù† ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ù„ÙØ§Øª</li>
                <li>Ø§ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© - ÙŠØ¬Ø¨ Ø£Ù† ØªØ¸Ù‡Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</li>
            </ol>
        </div>

        <div class="fix-card">
            <h2>ğŸš€ Ø§Ù„ÙÙˆØ§Ø¦Ø¯</h2>
            <ul>
                <li><strong>Ø­ÙØ¸ Ø¯Ø§Ø¦Ù…:</strong> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                <li><strong>Ø¹Ù„Ø§Ù‚Ø§Øª ØµØ­ÙŠØ­Ø©:</strong> Ø±Ø¨Ø· Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
                <li><strong>API Ø´Ø§Ù…Ù„:</strong> endpoints Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</li>
                <li><strong>Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ù„ÙØ§Øª:</strong> ØªØ®Ø²ÙŠÙ† Ù…Ù†Ø¸Ù… ÙÙŠ Ù…Ø¬Ù„Ø¯ Ù…Ø®ØµØµ</li>
                <li><strong>Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªÙˆØ³Ø¹:</strong> ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø©</li>
                <li><strong>ØªØªØ¨Ø¹ ÙƒØ§Ù…Ù„:</strong> Ù…Ø¹Ø±ÙØ© Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆÙ…ØªÙ‰</li>
            </ul>
        </div>
    </div>
</body>
</html>
