<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-card { background: white; border-radius: 12px; padding: 20px; margin: 16px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .test-header { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .debug-box { background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .code-block { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; margin: 12px 0; font-family: monospace; font-size: 14px; }
        .error-box { background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .success-box { background: #dcfce7; border: 1px solid #86efac; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .highlight { background: #fbbf24; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</h1>
        
        <div class="test-card">
            <div class="test-header">
                <h2>ğŸš¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø®Ø·Ø£</h2>
                <p>ØªØ´Ø®ÙŠØµ Ù…ÙØµÙ„ Ù„Ù…Ø´ÙƒÙ„Ø© Foreign Key Constraint</p>
            </div>
            
            <div class="error-box">
                <h3>âŒ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø­Ø§Ù„ÙŠ:</h3>
                <div class="code-block">
API Error [UNKNOWN_ERROR]: insert or update on table "session_media" <br>
violates foreign key constraint "<span class="highlight">session_media_uploaded_by_fkey</span>"
                </div>
                <p><strong>Ù„ÙƒÙ†:</strong> Ø§Ù„ØªØ­Ù‚Ù‚ Ø£Ø¸Ù‡Ø± Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</p>
            </div>
        </div>

        <div class="test-card">
            <h2>ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ</h2>
            
            <div class="success-box">
                <h3>âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯:</h3>
                <div class="code-block">
SELECT id, email, "firstName", "lastName" FROM users <br>
WHERE id = '0f851929-30b0-4b1c-8f64-779bd03dae03';<br><br>

<span class="highlight">Result:</span><br>
id: 0f851929-30b0-4b1c-8f64-779bd03dae03<br>
email: Ù…ÙˆØ²Ø©@zinat.local<br>
firstName: Ù…ÙˆØ²Ø©<br>
lastName: Ù…Ø¹Ù„Ù…Ø©
                </div>
            </div>
            
            <div class="success-box">
                <h3>âœ… Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø©:</h3>
                <div class="code-block">
SELECT id, task_title FROM weekly_session_plans LIMIT 5;<br><br>

<span class="highlight">Results:</span><br>
7ccdebb8-98a3-44a0-b9e0-0bb336908051 | wrthwth<br>
a861d053-aeac-4806-b5bf-2bc428478e03 | kgkuyf<br>
4b77be8a-4b83-4ef7-bf7b-babe48e20247 | .khfkhgc<br>
bdbd9209-0896-4cfc-b990-d40ae7f61999 | teheth<br>
b4017328-b047-4d7d-902c-94fdab41801d | tyjetyj
                </div>
            </div>
            
            <div class="debug-box">
                <h3>ğŸ” Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:</h3>
                <div class="code-block">
Foreign Key Constraints:<br>
- <span class="highlight">session_media_uploaded_by_fkey</span>: uploaded_by â†’ users(id)<br>
- <span class="highlight">session_media_session_plan_id_fkey</span>: session_plan_id â†’ weekly_session_plans(id)<br><br>

Data Types:<br>
- session_media.uploaded_by: <span class="highlight">UUID</span><br>
- users.id: <span class="highlight">UUID</span><br>
- session_media.session_plan_id: <span class="highlight">UUID</span><br>
- weekly_session_plans.id: <span class="highlight">UUID</span>
                </div>
            </div>
        </div>

        <div class="test-card">
            <h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</h2>
            
            <div class="error-box">
                <h3>âŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</h3>
                <div class="code-block">
INSERT INTO session_media (...) VALUES (<br>
  '123e4567-e89b-12d3-a456-426614174000',  -- session_plan_id (fake)<br>
  'test.jpg',<br>
  '/test/path',<br>
  'photo',<br>
  1024,<br>
  'image/jpeg',<br>
  '0f851929-30b0-4b1c-8f64-779bd03dae03'   -- uploaded_by (real)<br>
);<br><br>

<span class="highlight">ERROR:</span> violates foreign key constraint "session_media_session_plan_id_fkey"<br>
<span class="highlight">DETAIL:</span> Key (session_plan_id)=(123e4567...) is not present in table "weekly_session_plans"
                </div>
                <p><strong>Ø§Ù„Ø§ÙƒØªØ´Ø§Ù:</strong> Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙÙŠ session_plan_id ÙˆÙ„ÙŠØ³ uploaded_by!</p>
            </div>
        </div>

        <div class="test-card">
            <h2>ğŸ’¡ Ø§Ù„Ø­Ù„</h2>
            
            <div class="success-box">
                <h3>ğŸ¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©:</h3>
                <ul>
                    <li>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…Ø¶Ù„Ù„Ø© - ØªØ´ÙŠØ± Ø¥Ù„Ù‰ uploaded_by</li>
                    <li>Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© ÙÙŠ session_plan_id</li>
                    <li>Frontend ÙŠØ±Ø³Ù„ Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</li>
                    <li>Ø£Ùˆ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                </ul>
            </div>
            
            <div class="debug-box">
                <h3>ğŸ”§ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­:</h3>
                <ol>
                    <li><strong>Ø¥Ø¶Ø§ÙØ© ØªØ´Ø®ÙŠØµ Ù…ÙØµÙ„:</strong> Ø·Ø¨Ø§Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª</li>
                    <li><strong>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹</li>
                    <li><strong>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© ØµØ­ÙŠØ­:</strong> Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                    <li><strong>ØªØ­Ø³ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£:</strong> ÙÙŠ Backend</li>
                </ol>
            </div>
        </div>

        <div class="test-card">
            <h2>ğŸš€ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
            
            <div class="code-block">
// ÙÙŠ Frontend - Ø¥Ø¶Ø§ÙØ© ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„<br>
console.log('ğŸ” Session plan ID:', selectedTask.value.id)<br>
console.log('ğŸ” Session plan ID type:', typeof selectedTask.value.id)<br>
console.log('ğŸ” Session plan ID is valid UUID:', /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(selectedTask.value.id))<br><br>

// ÙÙŠ Backend - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©<br>
console.log('ğŸ” Backend received:');<br>
console.log('  - Session plan ID:', sessionPlanId);<br>
console.log('  - Uploaded by:', uploadedBy);<br><br>

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬<br>
const sessionExists = await weeklySessionPlanRepository.findOne({ where: { id: sessionPlanId } });<br>
if (!sessionExists) {<br>
  throw new BadRequestException(`Session plan ${sessionPlanId} not found`);<br>
}
            </div>
        </div>

        <div class="test-card">
            <h2>ğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„</h2>
            
            <div class="success-box">
                <h3>ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
                <ol>
                    <li>ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¹ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯</li>
                    <li>Ù…Ø­Ø§ÙˆÙ„Ø© Ø±ÙØ¹ Ù…Ù„Ù ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Console</li>
                    <li>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø±Ø³Ù„</li>
                    <li>Ù…Ù‚Ø§Ø±Ù†ØªÙ‡ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                    <li>Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</li>
                </ol>
            </div>
            
            <p style="text-align: center; font-size: 18px; color: #f59e0b; font-weight: bold; margin-top: 20px;">
                ğŸ” Ø§Ù„Ø¢Ù† Ù„Ø¯ÙŠÙ†Ø§ ØªØ´Ø®ÙŠØµ Ø¯Ù‚ÙŠÙ‚ - Ù„Ù†Ø¬Ø¯ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©!
            </p>
        </div>
    </div>
</body>
</html>
