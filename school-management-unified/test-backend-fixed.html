<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backend Fixed - File Upload Working</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .fix-card { background: white; border-radius: 12px; padding: 20px; margin: 16px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .fix-header { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .success-box { background: #dcfce7; border: 1px solid #86efac; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .code-block { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; margin: 12px 0; font-family: monospace; font-size: 14px; }
        .highlight { background: #10b981; color: white; padding: 2px 4px; border-radius: 3px; }
        .demo-button { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 8px; transition: transform 0.2s; }
        .demo-button:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Backend Ù…ÙØµÙ„Ø­ - Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØ¹Ù…Ù„!</h1>
        
        <div class="fix-card">
            <div class="fix-header">
                <h2>ğŸ‰ ØªÙ… Ø¥ØµÙ„Ø§Ø­ Backend Ø¨Ù†Ø¬Ø§Ø­</h2>
                <p>SessionMediaController ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ</p>
            </div>
            
            <div class="success-box">
                <h3>âœ… Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙŠ ØªÙ… Ø­Ù„Ù‡Ø§:</h3>
                <ul>
                    <li><strong>Ø®Ø·Ø£ Crypto:</strong> ØªÙ… Ø¥Ø¶Ø§ÙØ© crypto polyfill Ù„Ù€ Node.js 16</li>
                    <li><strong>SessionMediaController:</strong> Ù…Ø³Ø¬Ù„ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</li>
                    <li><strong>TypeORM Repository:</strong> SessionMedia entity Ù…ØªØ§Ø­</li>
                    <li><strong>File Upload Endpoints:</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„</li>
                </ul>
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ”§ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</h2>
            
            <h3>1. Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Crypto ÙÙŠ Node.js 16:</h3>
            <div class="code-block">
// Ø¥Ù†Ø´Ø§Ø¡ crypto-polyfill.ts<br>
import { randomBytes, randomUUID } from 'crypto';<br><br>

if (typeof global.crypto === 'undefined') {<br>
  global.crypto = {<br>
    getRandomValues: (array: any) => {<br>
      const bytes = randomBytes(array.length);<br>
      for (let i = 0; i < array.length; i++) {<br>
        array[i] = bytes[i];<br>
      }<br>
      return array;<br>
    },<br>
    <span class="highlight">randomUUID: randomUUID</span><br>
  } as any;<br>
}
            </div>
            
            <h3>2. ØªØ­Ø¯ÙŠØ« main.ts Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Polyfill:</h3>
            <div class="code-block">
// Import crypto polyfill first<br>
<span class="highlight">import './crypto-polyfill';</span><br><br>

import { NestFactory } from '@nestjs/core';<br>
import { ValidationPipe } from '@nestjs/common';<br>
import { AppModule } from './app.module';
            </div>
            
            <h3>3. Ø¥ØµÙ„Ø§Ø­ JWT Configuration:</h3>
            <div class="code-block">
// ÙÙŠ auth.module.ts<br>
JwtModule.register({<br>
  secret: process.env.JWT_SECRET || 'default-secret',<br>
  signOptions: {<br>
    <span class="highlight">expiresIn: process.env.JWT_EXPIRES_IN || '24h' as any,</span><br>
  },<br>
}),
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸš€ Backend ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†</h2>
            
            <div class="success-box">
                <h3>ğŸ“‹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>
                <div class="code-block">
âœ… POST /api/session-media/upload<br>
âœ… <span class="highlight">POST /api/session-media/upload-multiple</span><br>
âœ… GET /api/session-media/session/:sessionPlanId<br>
âœ… GET /api/session-media/:id<br>
âœ… DELETE /api/session-media/:id
                </div>
            </div>
            
            <div class="success-box">
                <h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± API:</h3>
                <div class="code-block">
curl -X GET http://localhost:3002/api/session-media/session/7ccdebb8-98a3-44a0-b9e0-0bb336908051<br><br>

<span class="highlight">Response:</span> âœ… Success!<br>
[<br>
  {<br>
    "id": 9,<br>
    "session_plan_id": "7ccdebb8-98a3-44a0-b9e0-0bb336908051",<br>
    "file_name": "LWScreenShot 2024-12-05 at 12.16.33Ã¢Â¯PM.png",<br>
    "file_path": "/api/files/session-media/session_1763223636961_2t6ubkthryd.png",<br>
    "file_type": "photo",<br>
    "file_size": 5095227,<br>
    "mime_type": "image/png",<br>
    "uploaded_by": "0f851929-30b0-4b1c-8f64-779bd03dae03",<br>
    "uploaded_at": "2025-11-15T16:20:36.992Z"<br>
  }<br>
]
                </div>
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ¯ Frontend Ù…ÙØ­Ø¯Ø«</h2>
            
            <div class="success-box">
                <h3>âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø¤Ù‚ØªØ©:</h3>
                <ul>
                    <li><strong>Ù„Ø§ Ù…Ø²ÙŠØ¯ Ù…Ù† Local Storage:</strong> Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙØ­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                    <li><strong>Ø§Ø³ØªØ®Ø¯Ø§Ù… Task ID Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ:</strong> Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ø¹Ø±Ù Ø«Ø§Ø¨Øª</li>
                    <li><strong>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ ØµØ­ÙŠØ­Ø©:</strong> Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø©</li>
                    <li><strong>ØªØ´Ø®ÙŠØµ Ù…Ø¨Ø³Ø·:</strong> Ø±Ø³Ø§Ø¦Ù„ console Ù…ÙÙŠØ¯Ø©</li>
                </ul>
            </div>
            
            <div class="code-block">
// Frontend Code - Clean & Proper<br>
const uploadedMedia = await sessionMediaService.uploadMultipleFiles(<br>
  <span class="highlight">selectedTask.value.id</span>, // Real task ID<br>
  files,<br>
  uploadUserId<br>
)<br><br>

// Update task with real database response<br>
selectedTask.value.media = uploadedMedia.map(media => ({<br>
  id: media.id.toString(),<br>
  file_name: media.file_name,<br>
  file_type: media.file_type,<br>
  file_size: media.file_size,<br>
  <span class="highlight">file_url: media.file_path</span>, // Real server path<br>
  uploaded_at: media.uploaded_at,<br>
  mime_type: media.mime_type<br>
}))
            </div>
        </div>

        <div class="fix-card">
            <h2>ğŸ§ª ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            
            <div class="success-box">
                <h3>Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h3>
                <ol>
                    <li><strong>ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Backend:</strong> http://localhost:3002</li>
                    <li><strong>Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©:</strong> /teacher-weekly-sessions</li>
                    <li><strong>Ø§Ø®ØªØ± Ù…Ù‡Ù…Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©:</strong> Ø§Ø¶ØºØ· "Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©"</li>
                    <li><strong>Ø£Ø¶Ù ÙˆØµÙ ÙˆÙ…Ù„ÙØ§Øª:</strong> Ø§ÙƒØªØ¨ ÙˆØµÙ ÙˆØ£Ø±ÙÙ‚ ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</li>
                    <li><strong>Ø§Ø¶ØºØ· Ø­ÙØ¸:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡</li>
                    <li><strong>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                </ol>
            </div>
            
            <h3>ğŸ” Ø±Ø³Ø§Ø¦Ù„ Console Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</h3>
            <div class="code-block">
ğŸ“ Uploading 2 files for user: 0f851929-30b0-4b1c-8f64-779bd03dae03<br>
ğŸ“ Uploading files to database...<br>
ğŸ“ Uploading 2 files to session plan: [task-id]<br>
ğŸ“ Backend: Uploading 2 files for session: [task-id]<br>
âœ… Successfully uploaded 2 files<br>
âœ… Files uploaded successfully to database: [...]<br>
ğŸ’¾ Saving task completion to backend...<br>
âœ… Task completion saved to backend: {...}<br>
âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="demo-button" onclick="window.open('http://localhost:3002/api/session-media/session/7ccdebb8-98a3-44a0-b9e0-0bb336908051', '_blank')">
                    ğŸ§ª Ø§Ø®ØªØ¨Ø± API Ù…Ø¨Ø§Ø´Ø±Ø©
                </button>
                <button class="demo-button" onclick="window.open('http://localhost:5173/teacher-weekly-sessions', '_blank')">
                    ğŸ“‹ Ø§Ø®ØªØ¨Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
                </button>
            </div>
        </div>

        <div class="fix-card">
            <h2>âœ… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
            
            <div class="success-box">
                <h3>ğŸ¯ Ù…Ø§ ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†:</h3>
                <ul>
                    <li>âœ… <strong>Backend Ù…Ø³ØªÙ‚Ø±:</strong> Ù„Ø§ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø£Ø®Ø·Ø§Ø¡ crypto</li>
                    <li>âœ… <strong>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª:</strong> ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ</li>
                    <li>âœ… <strong>Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…</li>
                    <li>âœ… <strong>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª:</strong> ØªØ¸Ù‡Ø± Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</li>
                    <li>âœ… <strong>Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ø§Ù…:</strong> ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©</li>
                    <li>âœ… <strong>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:</strong> Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ÙÙŠØ¯Ø©</li>
                </ul>
            </div>
            
            <p style="text-align: center; font-size: 18px; color: #10b981; font-weight: bold; margin-top: 20px;">
                ğŸ‰ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ - Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø­Ù‚ÙŠÙ‚ÙŠ! ğŸ‰
            </p>
        </div>
    </div>
</body>
</html>
