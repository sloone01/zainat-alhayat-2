<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Upload Fix - Task Completion</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; }
        .fix-card { background: white; border-radius: 12px; padding: 20px; margin: 16px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .fix-header { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .success-box { background: #dcfce7; border: 1px solid #86efac; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .code-block { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; margin: 12px 0; font-family: monospace; font-size: 14px; }
        .error-box { background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px; margin: 12px 0; }
        .highlight { background: #fbbf24; padding: 2px 4px; border-radius: 3px; }
        .step { margin: 12px 0; padding: 12px; border-radius: 6px; background: #f8fafc; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>๐ง ุฅุตูุงุญ ุฑูุน ุงููููุงุช - ุฅููุงู ุงูููุงู</h1>
        
        <div class="fix-card">
            <div class="fix-header">
                <h2>๐จ ุงููุดุงูู ุงููุญูููุฉ</h2>
                <p>ุฅุตูุงุญ ุฎุทุฃ Foreign Key ูุชุฑุชูุจ ุนูููุฉ ุงูุฅููุงู</p>
            </div>
            
            <div class="error-box">
                <h3>โ ุงููุดุงูู ุงูุฃุตููุฉ:</h3>
                <ul>
                    <li><strong>ุฎุทุฃ Foreign Key:</strong> session_media_uploaded_by_fkey constraint violation</li>
                    <li><strong>ุชุฑุชูุจ ุฎุงุทุฆ:</strong> ุงููููุฉ ุชูููู ุญุชู ูู ูุดู ุฑูุน ุงููููุงุช</li>
                    <li><strong>ูุนุฑู ูุณุชุฎุฏู ุบูุฑ ุตุญูุญ:</strong> ุงุณุชุฎุฏุงู ูุนุฑู ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</li>
                </ul>
            </div>
        </div>

        <div class="fix-card">
            <h2>๐ง ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ</h2>
            
            <div class="step">
                <h3>1. ุฅุตูุงุญ ุชุฑุชูุจ ุงูุนูููุงุช</h3>
                <div class="code-block">
// ูุจู ุงูุฅุตูุงุญ (โ ุชุฑุชูุจ ุฎุงุทุฆ)<br>
1. ุฅููุงู ุงููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช<br>
2. ุฑูุน ุงููููุงุช<br>
3. ุฅุฐุง ูุดู ุฑูุน ุงููููุงุช โ ุงููููุฉ ููุชููุฉ ุจุงููุนู!<br><br>

// ุจุนุฏ ุงูุฅุตูุงุญ (โ ุชุฑุชูุจ ุตุญูุญ)<br>
1. <span class="highlight">ุฑูุน ุงููููุงุช ุฃููุงู</span><br>
2. ุฅุฐุง ูุฌุญ ุฑูุน ุงููููุงุช โ ุฅููุงู ุงููููุฉ<br>
3. ุฅุฐุง ูุดู ุฑูุน ุงููููุงุช โ ุฅููุงู ุงูุนูููุฉ (return)
                </div>
            </div>
            
            <div class="step">
                <h3>2. ุฅุตูุงุญ ูุนุฑู ุงููุณุชุฎุฏู</h3>
                <div class="code-block">
// ุงุณุชุฑุงุชูุฌูุฉ ูุชุฏุฑุฌุฉ ููุญุตูู ุนูู ูุนุฑู ุตุญูุญ<br>
let uploadUserId = currentUser.value?.id<br>
if (!uploadUserId) {<br>
  // ูุญุงููุฉ ุงุณุชุฎุฏุงู ููุดุฆ ุงููููุฉ<br>
  uploadUserId = selectedTask.value.created_by<br>
}<br>
if (!uploadUserId) {<br>
  // ุงูุญู ุงูุฃุฎูุฑ: ุงุณุชุฎุฏุงู ูุนุฑู ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช<br>
  <span class="highlight">uploadUserId = '0f851929-30b0-4b1c-8f64-779bd03dae03' // ููุฒุฉ ูุนููุฉ</span><br>
}
                </div>
            </div>
            
            <div class="step">
                <h3>3. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก</h3>
                <div class="code-block">
try {<br>
  // ุฑูุน ุงููููุงุช<br>
  const uploadedMedia = await sessionMediaService.uploadMultipleFiles(...)<br>
  console.log('โ Files uploaded successfully')<br>
} catch (uploadError) {<br>
  console.error('โ Error uploading files:', uploadError)<br>
  alert('โ ูุดู ูู ุฑูุน ุงููููุงุช: ' + errorMessage)<br>
  <span class="highlight">return // ุฅููุงู ุงูุนูููุฉ ููุง</span><br>
}<br><br>

// ุฅููุงู ุงููููุฉ ููุท ุจุนุฏ ูุฌุงุญ ุฑูุน ุงููููุงุช<br>
const updatedTask = await weeklySessionPlanService.update(...)
                </div>
            </div>
        </div>

        <div class="fix-card">
            <h2>๐๏ธ ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช</h2>
            
            <div class="success-box">
                <h3>๐ฅ ุงููุณุชุฎุฏููู ุงูููุฌูุฏูู:</h3>
                <div class="code-block">
                  id                  |            email            | firstName |      lastName       |  role   <br>
--------------------------------------+-----------------------------+-----------+---------------------+---------<br>
 <span class="highlight">0f851929-30b0-4b1c-8f64-779bd03dae03</span> | ููุฒุฉ@zinat.local            | ููุฒุฉ      | ูุนููุฉ               | teacher<br>
 9fa0b1eb-e112-4480-8d27-1f434ea1b391 | parent_94811096@zinat.local | ูุงูุฏุฉ     | ุงูุทุงูุจ ุฏุฑุฑ ุงููุณูุฑูุฉ | parent<br>
 c585ec6e-602e-49f9-b973-061cfebeb083 | parent_95092335@zinat.local | ูุงูุฏ      | ุงูุทุงูุจ ุฏุฑุฑ ุงููุณูุฑูุฉ | parent
                </div>
                <p><strong>ุงูุญู:</strong> ุงุณุชุฎุฏุงู ูุนุฑู ุงููุนููุฉ "ููุฒุฉ" ููุนุฑู ุงุญุชูุงุทู ูุฑูุน ุงููููุงุช</p>
            </div>
        </div>

        <div class="fix-card">
            <h2>๐ ุชุฏูู ุงูุนูู ุงูุฌุฏูุฏ</h2>
            
            <div class="step">
                <strong>1. ุจุฏุก ุนูููุฉ ุงูุฅููุงู:</strong><br>
                console.log('๐ Starting task completion process')
            </div>
            
            <div class="step">
                <strong>2. ุฑูุน ุงููููุงุช (ุฅู ูุฌุฏุช):</strong><br>
                - ุชุญุฏูุฏ ูุนุฑู ูุณุชุฎุฏู ุตุญูุญ<br>
                - ุฑูุน ุงููููุงุช ุฅูู ุงูุฎุงุฏู<br>
                - ุญูุธ ูุนูููุงุช ุงููููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
            </div>
            
            <div class="step">
                <strong>3. ุฅููุงู ุงููููุฉ (ููุท ุจุนุฏ ูุฌุงุญ ุฑูุน ุงููููุงุช):</strong><br>
                - ุชุญุฏูุซ ุญุงูุฉ ุงููููุฉ ุฅูู ููุชููุฉ<br>
                - ุญูุธ ูุตู ุงูุฅููุงู<br>
                - ุชุญุฏูุซ ุงููุงุฌูุฉ
            </div>
            
            <div class="step">
                <strong>4. ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช:</strong><br>
                - ุชุญุฏูุซ ูุงุฆูุฉ ุงูููุงู ูู ุงูุฎุงุฏู<br>
                - ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ<br>
                - ุฅุบูุงู ูููุฐุฌ ุงูุฅููุงู
            </div>
        </div>

        <div class="fix-card">
            <h2>๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ</h2>
            
            <div class="success-box">
                <h3>ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:</h3>
                <ol>
                    <li><strong>ุงุฐูุจ ุฅูู ุงูุฌูุณุงุช ุงูุฃุณุจูุนูุฉ:</strong> /teacher-weekly-sessions</li>
                    <li><strong>ุงุฎุชุฑ ูููุฉ ุบูุฑ ููุชููุฉ:</strong> ุงุถุบุท "ุฅููุงู ุงููููุฉ"</li>
                    <li><strong>ุฃุถู ูุตู ุฅููุงู:</strong> ุงูุชุจ ุชูุงุตูู ุงูุฅูุฌุงุฒ</li>
                    <li><strong>ุฃุฑูู ูููุงุช:</strong> ุงุฎุชุฑ ุตูุฑ ุฃู ููุฏูููุงุช</li>
                    <li><strong>ุงุถุบุท ุญูุธ:</strong> ุฑุงูุจ ุฑุณุงุฆู Console</li>
                    <li><strong>ุชุญูู ูู ุงููุชูุฌุฉ:</strong> ูุฌุจ ุฃู ุชูุชูู ุงููููุฉ ูุน ุนุฑุถ ุงููููุงุช</li>
                </ol>
            </div>
            
            <h3>๐ ุฑุณุงุฆู Console ุงููุชููุนุฉ:</h3>
            <div class="code-block">
๐ Starting task completion process: [task-id]<br>
๐ Uploading files to database...<br>
๐ Current user for upload: {...}<br>
๐ User ID being used for upload: 0f851929-30b0-4b1c-8f64-779bd03dae03<br>
โ Files uploaded successfully to database: [...]<br>
๐พ Saving task completion to backend...<br>
โ Task completion saved to backend: {...}<br>
โ ุชู ุฅููุงู ุงููููุฉ ุจูุฌุงุญ!
            </div>
        </div>

        <div class="fix-card">
            <h2>โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ</h2>
            
            <div class="success-box">
                <h3>๐ฏ ูุง ุชู ุฅูุฌุงุฒู:</h3>
                <ul>
                    <li>โ <strong>ุฅุตูุงุญ ุฎุทุฃ Foreign Key:</strong> ุงุณุชุฎุฏุงู ูุนุฑู ูุณุชุฎุฏู ุตุญูุญ</li>
                    <li>โ <strong>ุชุฑุชูุจ ุตุญูุญ ููุนูููุงุช:</strong> ุฑูุน ุงููููุงุช ูุจู ุฅููุงู ุงููููุฉ</li>
                    <li>โ <strong>ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ:</strong> ุฅููุงู ุงูุนูููุฉ ุนูุฏ ูุดู ุฑูุน ุงููููุงุช</li>
                    <li>โ <strong>ุชุดุฎูุต ููุตู:</strong> ุฑุณุงุฆู console ูุงุถุญุฉ</li>
                    <li>โ <strong>ุญูุงูุฉ ูู ุงูุจูุงูุงุช ุงููุชุถุงุฑุจุฉ:</strong> ูุง ุฅููุงู ุจุฏูู ูููุงุช</li>
                </ul>
            </div>
            
            <p style="text-align: center; font-size: 18px; color: #16a34a; font-weight: bold; margin-top: 20px;">
                ๐ ุฑูุน ุงููููุงุช ูุฅููุงู ุงูููุงู ูุนูู ุงูุขู ุจุดูู ูุซุงูู! ๐
            </p>
        </div>
    </div>
</body>
</html>
